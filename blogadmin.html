<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Blog Admin Panel</title>
<style>
/* ================== STYLES ================== */
body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background: #f5f7fa; padding: 20px; margin: 0; color: #2c3e50; }

/* Login */
#loginCard { display: flex; justify-content: center; align-items: center; height: 100vh; }
.login-card { background: #fff; padding: 40px 30px; border-radius: 15px; box-shadow: 0 8px 25px rgba(0,0,0,0.15); width: 320px; animation: fadeIn 0.5s ease; }
.login-card h2 { text-align: center; margin-bottom: 20px; color: #34495e; font-weight: 600; }
.login-card input { width: 92%; padding: 12px; margin-bottom: 15px; border-radius: 8px; border: 1px solid #dcdde1; transition: border 0.3s; }
.login-card input:focus { border-color: #3498db; outline: none; }
.login-card button { width: 100%; padding: 12px; border: none; border-radius: 8px; background: linear-gradient(135deg,#3498db,#2980b9); color: #fff; cursor: pointer; font-size: 1rem; transition: transform 0.2s, box-shadow 0.2s; }
.login-card button:hover { transform: translateY(-2px); box-shadow: 0 4px 12px rgba(52,152,219,0.4); }
.error { color: #e74c3c; font-size: 0.9rem; text-align: center; margin-bottom: 10px; }

/* Admin Panel */
#adminPanel { display: none; animation: fadeIn 0.5s ease; }
h1 { text-align: center; margin-bottom: 25px; font-weight: 700; color: #2c3e50; }
h2.formTitle { margin-bottom: 15px; color: #34495e; text-align: center; font-weight: 600; }

/* Form */
form { background: #fff; padding: 35px 30px; border-radius: 15px; box-shadow: 0 12px 30px rgba(0,0,0,0.12); margin: 0 auto 40px; max-width: 900px; transition: transform 0.3s ease, box-shadow 0.3s ease; position: relative; }
form:hover { transform: translateY(-3px); box-shadow: 0 16px 35px rgba(0,0,0,0.15); }
form input, form textarea { width: 98%; padding: 14px 16px; margin-bottom: 18px; border: 1px solid #dcdde1; border-radius: 10px; font-size: 1rem; font-family: inherit; transition: border 0.3s, box-shadow 0.3s; background-color: #f9f9f9; }
form input:focus, form textarea:focus { border-color: #3498db; outline: none; box-shadow: 0 0 8px rgba(52,152,219,0.3); }
form button { flex: 1; padding: 14px 0; font-size: 1rem; font-weight: 600; border-radius: 10px; cursor: pointer; transition: all 0.3s ease; border: none; }
#submitBtn { background: linear-gradient(135deg,#3498db,#2980b9); color:white; margin-right:12px; }
#submitBtn:hover { transform: translateY(-2px); box-shadow: 0 6px 15px rgba(52,152,219,0.4); }
#cancelEditBtn { background:#7f8c8d; color:white; }
#cancelEditBtn:hover { background:#636e72; }
form div[style*="display:flex"] { display:flex; gap:12px; flex-wrap:wrap; justify-content:flex-end; }

/* Table */
.table-container { overflow-x: auto; max-width:100%; }
table { width:100%; border-collapse: collapse; background:#fff; box-shadow:0 8px 25px rgba(0,0,0,0.1); border-radius:12px; overflow:hidden; }
th, td { padding:14px 18px; text-align:left; }
th { background:linear-gradient(135deg,#3498db,#2980b9); color:white; font-weight:500; letter-spacing:0.5px; }
tr:nth-child(even){background:#f9f9f9;}
tr:hover{background:#f0f6fb;}
button.delete-btn{background:#e74c3c;color:#fff;border:none;border-radius:6px;padding:8px 12px;cursor:pointer;}
button.delete-btn:hover{background:#c0392b;}
button.edit-btn{background:#f39c12;color:#fff;border:none;border-radius:6px;padding:8px 12px;margin-right:5px;}
button.edit-btn:hover{background:#d68910;}

/* Animations */
@keyframes fadeIn { from{opacity:0;transform:translateY(10px);} to{opacity:1;transform:translateY(0);} }
</style>
</head>
<body>

<!-- Login -->
<div id="loginCard">
  <div class="login-card">
    <h2>Admin Login</h2>
    <div class="error" id="errorMsg"></div>
    <input type="text" id="username" placeholder="Username" required>
    <input type="password" id="password" placeholder="Password" required>
    <button onclick="login()">Login</button>
  </div>
</div>

<!-- Admin Panel -->
<div id="adminPanel">
  <h1>Blog Admin Panel</h1>
  <form id="blogForm">
    <h2 class="formTitle" id="formTitle">Add New Blog</h2>
    <input type="text" id="title" placeholder="Blog Title" required>
    <input type="text" id="author" placeholder="Author Name" required>
    <input type="date" id="date" required>
    <input type="text" id="image" placeholder="Image URL" required>
    <textarea id="summary" placeholder="Short Summary"></textarea>
    <textarea id="content" placeholder="Full Content"></textarea>
    <div style="display:flex; flex-wrap:wrap;">
      <button type="submit" id="submitBtn">Add Blog</button>
      <button type="button" id="cancelEditBtn" style="display:none;">Cancel Edit</button>
    </div>
  </form>

  <h2>All Blogs</h2>
  <div class="table-container">
    <table>
      <thead>
        <tr>
          <th>#</th>
          <th>Title</th>
          <th>Author</th>
          <th>Date</th>
          <th>Action</th>
        </tr>
      </thead>
      <tbody id="blogAdminTable"></tbody>
    </table>
  </div>
</div>

<!-- TinyMCE (No API Key Needed - cdnjs) -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/tinymce/6.8.3/tinymce.min.js" referrerpolicy="origin"></script>
<script>
tinymce.init({
  selector: '#summary, #content',
  plugins: 'lists link image table code',
  toolbar: 'undo redo | bold italic underline | bullist numlist | h2 h3 | link image | code',
  menubar: false,
  height: 300
});
</script>

<script>
// Login
async function hashString(str){
  const encoder = new TextEncoder();
  const data = encoder.encode(str);
  const hashBuffer = await crypto.subtle.digest('SHA-256', data);
  return Array.from(new Uint8Array(hashBuffer)).map(b=>b.toString(16).padStart(2,'0')).join('');
}
const storedUsernameHash="8c6976e5b5410415bde908bd4dee15dfb167a9c873fc4bb8a81f6f2ab448a918"; // admin
const storedPasswordHash="240be518fabd2724ddb6f04eeb1da5967448d7e831c08c8fa822809f74c720a9"; // password
async function login(){
  const username=document.getElementById('username').value.trim();
  const password=document.getElementById('password').value.trim();
  const hashedUsername=await hashString(username);
  const hashedPassword=await hashString(password);
  if(hashedUsername===storedUsernameHash && hashedPassword===storedPasswordHash){
    document.getElementById('loginCard').style.display='none';
    document.getElementById('adminPanel').style.display='block';
    loadBlogs();
  } else document.getElementById('errorMsg').innerText='Invalid username or password';
}

// -------- Blog Admin Panel --------
const API_URL="https://akhiluthomas-website-backend.onrender.com/api/blogs";

let blogs=[];
let editId=null;

async function loadBlogs(){
  try{
    const res=await fetch(API_URL);
    blogs=await res.json();
    renderAdminTable();
  } catch(err){ console.error("Failed to load blogs:",err); }
}

function renderAdminTable(){
  const table=document.getElementById("blogAdminTable");
  table.innerHTML="";
  if(blogs.length===0){
    table.innerHTML='<tr><td colspan="5" style="text-align:center;">No blogs found</td></tr>';
  }
  blogs.forEach((blog,i)=>{
    const date=new Date(blog.date).toLocaleDateString();
    table.innerHTML+=`
      <tr>
        <td>${i+1}</td>
        <td>${blog.title}</td>
        <td>${blog.author}</td>
        <td>${date}</td>
        <td>
          <button class="edit-btn" onclick="editBlog('${blog._id}')">Edit</button>
          <button class="delete-btn" onclick="deleteBlog('${blog._id}')">Delete</button>
        </td>
      </tr>
    `;
  });
}

function editBlog(id){
  const blog=blogs.find(b=>b._id===id);
  document.getElementById("title").value=blog.title;
  document.getElementById("author").value=blog.author;
  document.getElementById("date").value=new Date(blog.date).toISOString().split('T')[0];
  document.getElementById("image").value=blog.image;

  tinymce.get("summary").setContent(blog.summary || "");
  tinymce.get("content").setContent(blog.content || "");

  editId=id;
  document.getElementById("formTitle").innerText="Edit Blog";
  document.getElementById("submitBtn").innerText="Update Blog";
  document.getElementById("cancelEditBtn").style.display='inline-block';
}

document.getElementById("cancelEditBtn").addEventListener("click",function(){
  editId=null;
  document.getElementById("blogForm").reset();
  tinymce.get("summary").setContent("");
  tinymce.get("content").setContent("");
  document.getElementById("formTitle").innerText="Add New Blog";
  document.getElementById("submitBtn").innerText="Add Blog";
  this.style.display='none';
});

document.getElementById("blogForm").addEventListener("submit",async function(e){
  e.preventDefault();
  const blogData={
    title:document.getElementById("title").value,
    author:document.getElementById("author").value,
    date:document.getElementById("date").value,
    image:document.getElementById("image").value,
    summary:tinymce.get("summary").getContent(),
    content:tinymce.get("content").getContent()
  };
  try{
    let res;
    if(editId===null){
      res=await fetch(API_URL,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(blogData)});
    } else {
      res=await fetch(`${API_URL}/${editId}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(blogData)});
      editId=null;
      document.getElementById("formTitle").innerText="Add New Blog";
      document.getElementById("submitBtn").innerText="Add Blog";
      document.getElementById("cancelEditBtn").style.display='none';
    }
    console.log(await res.json());
    this.reset();
    tinymce.get("summary").setContent("");
    tinymce.get("content").setContent("");
    loadBlogs();
  } catch(err){ console.error("Error submitting blog:",err); }
});

async function deleteBlog(id){
  if(confirm("Are you sure you want to delete this blog?")){
    try{
      const res=await fetch(`${API_URL}/${id}`,{method:"DELETE"});
      console.log(await res.json());
      loadBlogs();
    } catch(err){ console.error("Failed to delete blog:",err); }
  }
}
</script>
</body>
</html>
